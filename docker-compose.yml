version: "3.8"

services:
  # Naming server Service
  registry-service:
    image: shamalmuneer/hacknconquer-registry
    mem_limit: 500m
    ports:
      - "8761:8761"
    networks:
      - hacknconquer-network
  # MySql
  mysql-db:
    image: mysql:8.0.37
    environment:
      MYSQL_ROOT_PASSWORD: password
    volumes:
      - C://Users/shama/Desktop/sql_dump/hacknconquer_backup.sql:/docker-entrypoint-initdb.d/init-db.sql
    ports:
      - "3307:3306"
    networks:
      - hacknconquer-network
  # Api Gateway Service
  api-gateway:
    image: shamalmuneer/hacknconquer-gateway:0.0.1
    mem_limit: 700m
    ports:
      - "8080:8080"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411

  # User Service
  user:
    image: shamalmuneer/hacknconquer-user:0.0.1
    mem_limit: 700m
    ports:
      - "8100:8100"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
      - mysql-db
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411
      SPRING.DATASOURCE.URL: jdbc:mysql://mysql-db:3306/hacknconquer_user

  #Payment Service 
  payment:
    image: shamalmuneer/hacknconquer-payment:0.0.1
    mem_limit: 700m
    ports:
      - "8900:8900"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
      - mysql-db
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411
      SPRING.DATASOURCE.URL: jdbc:mysql://mysql-db:3306/hacknconquer_payment
      
  #Discussion Service 
  discussion:
    image: shamalmuneer/hacknconquer-discussion:0.0.1
    mem_limit: 700m
    ports:
      - "8600:8600"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
      - mysql-db
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411
      SPRING.DATASOURCE.URL: jdbc:mysql://mysql-db:3306/hacknconquer_discussion

  #Clan Service 
  clan:
    image: shamalmuneer/hacknconquer-clan:0.0.1
    mem_limit: 700m
    ports:
      - "9600:9600"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
      - mysql-db
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411
      SPRING.DATASOURCE.URL: jdbc:mysql://mysql-db:3306/hacknconquer_clan
  #Chat Service 
  chat:
    image: shamalmuneer/hacknconquer-chat:0.0.1
    mem_limit: 700m
    ports:
      - "9800:9800"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
      - mysql-db
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411
      SPRING.DATASOURCE.URL: jdbc:mysql://mysql-db:3306/hacknconquer_chat

  # Notification Service 
  notification:
    image: shamalmuneer/hacknconquer-notification:0.0.1
    mem_limit: 700m
    ports:
      - "8700:8700"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
      - mysql-db
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411
      SPRING.DATASOURCE.URL: jdbc:mysql://mysql-db:3306/hacknconquer_notification
  

  # Problem Service
  problem:
    image: shamalmuneer/hacknconquer-problem:0.0.1
    mem_limit: 700m
    ports:
      - "8200:8200"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411

# Test Service
  test:
    image: shamalmuneer/hacknconquer-test:0.0.1
    mem_limit: 700m
    ports:
      - "8500:8500"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411
      
# Submission Service
  submission:
    image: shamalmuneer/hacknconquer-submission:0.0.1
    mem_limit: 700m
    ports:
      - "8400:8400"
    networks:
      - hacknconquer-network
    depends_on:
      - registry-service
    environment:
      EUREKA.CLIENT.SERVICEURL.DEFAULTZONE: http://registry-service:8761/eureka
      MANAGEMENT.ZIPKIN.TRACING.ENDPOINT: http://zipkin-server:9411

# Zipkin
  zipkin-server:
    image: openzipkin/zipkin:2.23
    mem_limit: 300m
    ports:  
      - "9411:9411"
    networks:
      - hacknconquer-network
    restart: always

networks:
  hacknconquer-network: